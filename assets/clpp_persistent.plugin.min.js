/*! @castlabs/prestoplay 5.1.38, 23-03-2020 Copyright (c) 2020 castLabs GmbH, All Rights reserved */

(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define(['clpp'],factory);else if(typeof exports==="object")exports["clpp_persistent"]=factory();else root["clpp_persistent"]=factory()})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="/";return __webpack_require__(0)}({0:function(module,exports,__webpack_require__){module.exports=__webpack_require__(51)},51:function(module,exports){!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["clpp_persistent"]=t():e["clpp_persistent"]=t()}(this,function(){return webpackJsonpclpp__name_([13],{0:function(e,t,i){var n=i(174);e.exports=n},174:function(e,t,i){function n(e){var t="com.widevine.alpha",i="required",n="persistent-license",r=[{contentType:'video/mp4;codecs="avc1.42c00c"',robustness:"SW_SECURE_DECODE"}],s=[{contentType:'audio/mp4;codecs="mp4a.40.2"',robustness:"SW_SECURE_CRYPTO"}],a={keySystem:t,sessionType:n,basicConfig:{audioCapabilities:s,videoCapabilities:r},offlineConfig:{audioCapabilities:s,videoCapabilities:r,persistentState:i,sessionTypes:[n]},serverCertificate:e};return a}function r(e,t,i,n){return new Promise(function(r,s){function a(){if(200==this.status){var e;n(this);for(var t=new Uint8Array(this.response),i="",s=0;s<t.byteLength;++s)i+=String.fromCharCode(t[s]);var a=i.trim();if(0==a.indexOf("{")&&a.lastIndexOf("}")==a.length-1){var o;try{o=JSON.parse(i)}catch(e){}e=u.base64ToArr(o.license)}else e=t;r(e)}else c()}function o(){s({message:'DRM: widevine update, XHR aborted. status is "'+h.statusText+'" ('+h.status+"), readyState is "+h.readyState,response:"NONE",status:h.status,statusText:h.statusText,responseURL:h.responseURL})}function c(){s({message:'DRM: widevine update, XHR Error. status is "'+h.statusText+'" ('+h.status+"), readyState is "+h.readyState,response:"NONE",status:h.status,statusText:h.statusText,responseURL:h.responseURL})}function l(){s({message:'DRM: widevine update, XHR timeout. status is "'+h.statusText+'" ('+h.status+"), readyState is "+h.readyState,response:"NONE",status:h.status,statusText:h.statusText,responseURL:h.responseURL})}var h=new XMLHttpRequest;h.timeout=1e4,h.open("POST",t,!0),h.responseType="arraybuffer",h.onload=a,h.onabort=o,h.onerror=c,h.ontimeout=l,i(h),h.send(e)})}function s(e,t,i,n,s){return new Promise(function(a,o){e.addEventListener("message",function(e){var t=e.message;r(t,i,n,s).then(function(e){a(e)},function(e){o(e)})}),e.generateRequest("cenc",t).then(function(){}).catch(function(){o("generating request for session failed")})})}function a(e,t,i,n,r){return new Promise(function(a,o){navigator.requestMediaKeySystemAccess(e.keySystem,[e.offlineConfig,e.basicConfig]).then(function(e){return e.createMediaKeys()}).catch(function(){o("Unable to instantiate a key system supporting the required combinations")}).then(function(c){var l=c.createSession(e.sessionType);c.setServerCertificate(e.serverCertificate);var h=u.base64ToArr(t).buffer;s(l,h,i,n,r).then(function(e){l.update(e).then(function(){a(l)}).catch(function(){o("couldn't update session with downloaded license")})},o)}).catch(function(){o("Unable to instantiate a key system supporting the required combinations")})})}function o(e){var t=n(e.serverCertificate),i=e.licenseUrl,r=e.pssh,s=e.licenseRequest;"function"!=typeof s&&(s=function(){});var o=e.licenseResponse;return"function"!=typeof o&&(o=function(){}),new Promise(function(e,n){a(t,r,i,s,o).then(function(t){var i=t.sessionId;t.close(),e(i)},function(e){n(e)})})}function c(e){return new Promise(function(t){var i=n();navigator.requestMediaKeySystemAccess(i.keySystem,[i.offlineConfig,i.basicConfig]).then(function(e){return e.createMediaKeys()}).catch(function(){t()}).then(function(n){var r=n.createSession(i.sessionType);window.setTimeout(function(){r.load(e).then(function(e){e&&r.remove(),t()},t)},l)}).catch(function(){t()})})}var u=i(8),l=500;t.createPersistentSession=o,t.removePersistentSession=c}})})}})});