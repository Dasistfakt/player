/*! @castlabs/prestoplay 5.1.36, 05-02-2020 Copyright (c) 2020 castLabs GmbH, All Rights reserved */

(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module==="object")module.exports=factory();else if(typeof define==="function"&&define.amd)define(['clpp'],factory);else if(typeof exports==="object")exports["clpp_basic_thumbnail"]=factory();else root["clpp_basic_thumbnail"]=factory()})(this,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="/";return __webpack_require__(0)}([function(module,exports,__webpack_require__){module.exports=__webpack_require__(1)},function(module,exports){!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["clpp_basic_thumbnail"]=t():e["clpp_basic_thumbnail"]=t()}(this,function(){return webpackJsonpclpp__name_([14],{0:function(e,t,i){var n=i(1),r="clpp_basic_thumbnail",s="BasicThumbnail";n.definePlugin(r,t),t.registerPlugin=function(e){var t=i(1),n=i(5).cl_ne,a=i(132),o=t.videojs.getComponent("Component"),c=i(2).cl_K;c.plugins[r]={},o.registerComponent(s,a),n(e,s)},t.unregisterPlugin=function(e){var t=i(5).cl_se;t(e,s)}},132:function(e,t,i){var n=i(1),r=n.videojs.getComponent("Component"),s=i(5).cl_q,a=i(2),o=i(3),c=n.videojs.extend(r,{constructor:function(e){r.call(this,e,{}),this.player_=e,this.cl_hT=o.throttlify2(this.cl_hT.bind(this),50),this.cl_nm=this.cl_nm.bind(this),this.cl_dT=this.cl_dT.bind(this),this.cl__T=this.cl__T.bind(this),this.cl_fT=this.cl_fT.bind(this),this.cl_pT=this.cl_pT.bind(this),this.cl_fT()},cl_fT:function(){this.cl_gT=0,this.cl_mT=0;var e=this.player_.options_.cl_Mt.cl_nc;this.options_=s(this.player_.tech_),this.cl_ET=this.options_.thumbnail&&this.options_.thumbnail.basicThumbnail,this.cl_ET?(this.cl_yT=this.cl_ET,n.error.raise(null,n.errors.CONFIG.DEPRECATED,{},null,{deprecated:'Section "basicThumbnail" in config.thumbnails',addedOn:"5.1.4",removedFrom:"5.1.5",newFeature:'"plugins.clpp_basic_thumbnail" section in config'})):this.cl_yT=e&&e[a.plugins.clpp_basic_thumbnail];var t=this.player_.controlBar,i=t.progressControl;this.progressControl=i,this.seekBar=i.seekBar,this.mouseTimeDisplay=this.seekBar.mouseTimeDisplay,this.videoJsElement=this.player_.el(),this.textTrackDisplay=this.player_.textTrackDisplay,this.player_.tech_.one("dispose",this.cl_pT),this.cl_yT&&(this.cl_Gm(),"function"==typeof this.cl_yT.onReady&&this.cl_yT.onReady(this,this.player_))},cl_AT:function(e){var t=document.body.getBoundingClientRect(),i=e.getBoundingClientRect();return{top:i.top-t.top,left:i.left-t.left}},cl_hT:function(e){var t=this.mouseTimeDisplay.el().getAttribute("data-current-time"),i=t.split(":").map(parseFloat).reverse(),n=i[0]+60*(i[1]||0)+3600*(i[2]||0);return this.getThumbnail(n).then(function(t){this.cl_gT>this.cl_mT&&this.cl_vT(t,e)}.bind(this)).catch(function(e){console.error(e)})},cl_ST:function(){var e=this.player_.el().querySelector(".tmp_thumbnail");e&&this.cl_TT(e)},cl_nm:function(e){this.cl_gT=Date.now(),this.cl_hT(e.clientX)},cl_dT:function(e){if(e.relatedTarget){var t=e.relatedTarget.className;if(t.indexOf("vjs-progress-control")>=0||t.indexOf("vjs-progress-holder")>=0||t.indexOf("vjs-mouse-display")>=0||t.indexOf("vjs-play-progress")>=0||t.indexOf("vjs-load-progress")>=0)return}this.cl_mT=Date.now(),this.cl_ST()},cl__T:function(){this.cl_mT=Date.now(),this.cl_ST()},cl_Gm:function(){this.progressControl.on("mousemove",this.cl_nm),this.progressControl.on("mouseout",this.cl_dT),this.player_.on("userinactive",this.cl__T)},cl_TT:function(e){if("remove"in e)e.remove();else{if(!("removeNode"in e))throw new Error("Error attempting to remove thumbnail DOM element");e.removeNode(!0)}},removeEvents:function(){this.progressControl.off("mousemove",this.cl_nm),this.progressControl.off("mouseout",this.cl_dT),this.player_.off("userinactive",this.cl__T)},cl_vT:function(e,t){var i,n,r,s,a=this.cl_yT.width,o=this.cl_yT.height;a&&o?(n=e.resize(a,o),r=a,s=o):(n=e.image,r=e.width,s=e.height);var c,u,l,h,d=this.textTrackDisplay.el().offsetWidth,_=this.textTrackDisplay.el().offsetHeight,f=this.player_.el(),p=40,g=this.cl_AT(f),m=t-g.left;i=f.querySelector(".tmp_thumbnail"),u=m-r/2,n?(n.className="tmp_thumbnail",d<r||_<s+p?(n=e.resize(d,_),n.style.cssText+="visibility: visible; position: absolute; top: 0px; left: 0px",i?i!==n&&f.replaceChild(n,i):f.appendChild(n)):(n.style.cssText+="visibility: visible; position: absolute; bottom: "+p+"px; left: "+u+"px",i?i!==n&&f.replaceChild(n,i):f.appendChild(n),c=this.cl_AT(n),h=n.offsetWidth+c.left,l=this.videoJsElement.offsetWidth+g.left,c.left<g.left&&(u=0,n.style.left=""+u+"px"),h>l&&(u=this.videoJsElement.offsetWidth-r,n.style.left=""+u+"px"))):i&&this.cl_TT(i)},cl_bT:function(){var e,t=this,i=this.mouseTimeDisplay.el().getAttribute("data-current-time");if(i=i.split(":").map(parseFloat).reverse(),i=i[0]+60*(i[1]||0)+3600*(i[2]||0),e=this.player_.tech_&&this.player_.tech_.getThumbnail(i),!e)throw new Error("BasicThumbnail failed: the tech is not available");e.then(function(e){t.cl_CT(e,i)})},getThumbnail:function(e,t,i){var n=this.player_.tech_&&this.player_.tech_.getThumbnail&&this.player_.tech_.getThumbnail(e);n||(n=Promise.reject("No thumbnails"));var r,s={time:e};return new Promise(function(e,a){n.then(function(n){return n.sprite?(s.image=n.sprite.get(t,i),s.width=parseInt(s.image.style.width,10),s.height=parseInt(s.image.style.height,10),s.type=s.image.tagName,s.resize=n.sprite.get.bind(n.sprite),e(s)):(r=n.image,t&&i&&(r.width=t,r.height=i),s.width=r.width,s.height=r.height,s.image=r,s.type=s.image.tagName,s.resize=function(e,t){return this.image.width=e||this.image.width,this.image.height=t||this.image.height,this.image},e(s))}).catch(function(e){return a(e)})})},onProgressBarHover:function(e){this.cl_CT=e,this.progressControl.on("mousemove",this.cl_bT.bind(this))},cl_pT:function(){this.removeEvents(),this.cl_ST(),this.cl_CT=null,this.player_.tech_.off("dispose",this.cl_pT),this.player_.one("ready",this.cl_fT)},dispose:function(){this.cl_pT(),this.player_.off("ready",this.cl_fT),r.prototype.dispose.call(this)}});e.exports=c}})})}])});